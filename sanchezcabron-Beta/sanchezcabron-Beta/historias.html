<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronicles - SanchezCabron OS</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body class="vlog-mode">
    <header class="header">
        <div class="container">
            <div class="logo">Chronicles</div>
            <nav class="nav">
                <a href="index.html">Inicio</a>
                <a href="series.html">Series</a>
                <a href="juegos.html">Juegos</a>
                <a href="historias.html" class="active">Historias</a>
                <a href="logros.html">üèÜ Logros</a>
                <a href="marcadores.html">Links</a>
                <a href="perfil.html">Perfil</a>
                <a href="vault.html" title="Acceso Privado"><i class="fa-solid fa-lock"></i></a>
            </nav>
        </div>
    </header>

    <main class="container section vlog-layout">
        <!-- Bot√≥n de Navegaci√≥n Flotante -->
        <a href="index.html" class="back-to-hub-btn glass-effect">
            <i class="fa-solid fa-arrow-left"></i> Volver al Hub
        </a>

        <!-- Header del Vlog -->
        <div class="vlog-header">
            <h1 class="vlog-title">CHRONICLES</h1>
            <p class="vlog-subtitle">Registros locales del sistema SANCHEZCABRON OS</p>
            
            <!-- Barra de Filtros (Est√©tica) -->
            <div class="filter-bar">
                <button class="filter-pill active">Todas</button>
                <button class="filter-pill">√âpicas</button>
                <button class="filter-pill">Personales</button>
                <button class="filter-pill">Sistema</button>
            </div>
        </div>

        <!-- VISTA 1: Biblioteca (Grid) -->
        <div id="view-library">
            <!-- Barra de Herramientas Global -->
            <div class="controls-bar">
                <button class="btn btn-secondary btn-import" onclick="app.triggerImport()"><i class="fa-solid fa-file-import"></i> Importar Historia</button>
                <button class="btn btn-secondary btn-export" onclick="app.exportLibrary()"><i class="fa-solid fa-file-export"></i> Exportar Biblioteca</button>
            </div>
            <input type="file" id="importFile" style="display:none" accept=".json" onchange="app.handleImport(event)">

            <div id="storiesGrid" class="stories-grid-container">
                <!-- Empty State se maneja en JS -->
            </div>
        </div>

        <!-- Bot√≥n Flotante para Nueva Historia -->
        <button id="btnNewStory" class="floating-btn" title="Crear Nueva Historia">
            <i class="fa-solid fa-feather-pointed"></i>
        </button>
    </main>

    <!-- Modal Creaci√≥n de Historia -->
    <div id="storyModal" class="modal-overlay" style="display: none;">
        <div class="modal-content form-container" style="max-width: 500px;">
            <button id="closeStoryModal" class="close-modal-btn">&times;</button>
            <h2><i class="fa-solid fa-book-journal-whills"></i> Nueva Cr√≥nica</h2>
            <form id="storyForm">
                <div class="form-group">
                    <label>T√≠tulo de la Historia</label>
                    <input type="text" id="storyTitle" class="terminal-input" required placeholder="Ej: Las Cr√≥nicas de Sanchez">
                </div>
                
                <div class="form-group">
                    <label>G√©nero</label>
                    <select id="storyGenre" class="terminal-input">
                        <option value="Aventura">‚öîÔ∏è Aventura</option>
                        <option value="Sci-Fi">üöÄ Sci-Fi</option>
                        <option value="Fantas√≠a">üîÆ Fantas√≠a</option>
                        <option value="Terror">üëª Terror</option>
                        <option value="Slice of Life">‚òï Slice of Life</option>
                        <option value="C√≥digo">üíª C√≥digo / Dev</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Portada (Nombre de archivo en img/historias/)</label>
                    <input type="text" id="storyCover" class="terminal-input" placeholder="Ej: portada1.jpg">
                </div>

                <button type="submit" class="btn" style="width: 100%;">Crear Historia</button>
            </form>
        </div>
    </div>

    <!-- Modal A√±adir Cap√≠tulo -->
    <div id="chapterModal" class="modal-overlay" style="display: none;">
        <div class="modal-content form-container" style="max-width: 800px;">
            <button onclick="document.getElementById('chapterModal').style.display='none'" class="close-modal-btn">&times;</button>
            <h2><i class="fa-solid fa-pen-nib"></i> Escribir Cap√≠tulo</h2>
            <form id="chapterForm">
                <div class="form-group">
                    <label>T√≠tulo del Cap√≠tulo</label>
                    <input type="text" id="chapTitle" class="terminal-input" required placeholder="Ej: Cap√≠tulo 1: El Despertar">
                </div>
                <div class="form-group">
                    <label>Contenido</label>
                    <textarea id="chapContent" class="terminal-input" rows="15" required placeholder="Escribe aqu√≠ tu historia..."></textarea>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Guardar Cap√≠tulo</button>
            </form>
        </div>
    </div>

    <!-- Modal Lore / Archivo de Datos -->
    <div id="loreModal" class="modal-overlay" style="display: none;">
        <div class="modal-content form-container" style="max-width: 800px; height: 80vh; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="margin:0;"><i class="fa-solid fa-database"></i> Archivo de Datos</h2>
                <button onclick="document.getElementById('loreModal').style.display='none'" class="close-modal-btn" style="position:static;">&times;</button>
            </div>
            
            <!-- Tabs Navegaci√≥n -->
            <div class="lore-tabs">
                <button class="lore-tab-btn active" onclick="app.switchLoreTab('synopsis')">Sinopsis</button>
                <button class="lore-tab-btn" onclick="app.switchLoreTab('world')">World Building</button>
                <button class="lore-tab-btn" onclick="app.switchLoreTab('chars')">Personajes</button>
                <button class="lore-tab-btn" onclick="app.switchLoreTab('album')">√Ålbum</button>
            </div>

            <!-- Contenido Tabs (Scrollable) -->
            <div style="flex: 1; overflow-y: auto; padding-right: 10px;">
                <!-- Tab 1: Sinopsis -->
                <div id="tab-synopsis" class="lore-panel active">
                    <div class="form-group">
                        <label>Resumen de la Trama</label>
                        <textarea id="loreSynopsis" class="terminal-input" rows="10" placeholder="Escribe aqu√≠ el resumen general de la historia..."></textarea>
                    </div>
                </div>

                <!-- Tab 2: World Building -->
                <div id="tab-world" class="lore-panel">
                    <div class="form-group">
                        <label>Escala de Poder / Niveles (Separa por comas)</label>
                        <input type="text" id="lorePowerScale" class="terminal-input power-scale-input" placeholder="Ej: RANGO E, RANGO D, RANGO S, CLASE DIOS">
                    </div>
                    <div class="form-group">
                        <label>Reglas del Mundo & Sistema de Magia</label>
                        <textarea id="loreWorldRules" class="terminal-input tech-font" rows="10" placeholder="Describe c√≥mo funciona la magia, la tecnolog√≠a o las leyes de este universo..."></textarea>
                    </div>
                </div>

                <!-- Tab 3: Personajes -->
                <div id="tab-chars" class="lore-panel">
                    <div id="charactersList" class="character-list-container">
                        <!-- Filas generadas por JS -->
                    </div>
                    <button class="btn btn-secondary" onclick="app.addCharacterRow()" style="width:100%; margin-top:1rem; border-style:dashed;"><i class="fa-solid fa-plus"></i> A√±adir Personaje</button>
                </div>
            </div>
            
            <!-- Tab 4: √Ålbum de Entidades -->
            <div id="tab-album" class="lore-panel">
                <div id="albumList" class="character-list-container">
                    <!-- Filas generadas por JS -->
                </div>
                <button class="btn btn-secondary" onclick="app.addAlbumImageRow()" style="width:100%; margin-top:1rem; border-style:dashed;"><i class="fa-solid fa-image"></i> A√±adir Imagen</button>
            </div>

            <button class="btn" onclick="app.saveLore()" style="margin-top: 1rem;">Guardar Archivo</button>
        </div>
    </div>

    <!-- Overlay de Lectura (Reader Mode) -->
    <div id="readerOverlay" class="reader-overlay" style="display: none;">
        <!-- Bot√≥n Salir Flotante -->
        <button class="reader-exit-btn" onclick="app.closeReader()"><i class="fa-solid fa-xmark"></i></button>
        
        <!-- Bot√≥n Flotante Consultar Archivos -->
        <button class="floating-lore-btn" onclick="app.showReaderLore()"><i class="fa-solid fa-database"></i> DATA</button>

        <!-- Escenario 3D del Libro -->
        <div class="book-scene">
            <div class="book-container" id="book3d">
                <!-- P√°gina Izquierda (Info / Decoraci√≥n) -->
                <div class="book-page page-left">
                    <div class="page-content-wrapper" id="pageLeftContent">
                        <!-- Se llena con JS -->
                    </div>
                </div>
                
                <!-- P√°gina Derecha (Texto Principal) -->
                <div class="book-page page-right">
                    <div class="bookmark-ribbon" id="bookmarkRibbon" onclick="app.toggleBookmark()" title="Guardar Marcap√°ginas">
                        <i class="fa-solid fa-bookmark"></i>
                    </div>
                    <div class="page-content-wrapper scrollable-text" id="pageRightContent">
                        <!-- Se llena con JS -->
                    </div>
                    <div class="page-number" id="pageNumberDisplay">1</div>
                </div>
            </div>
        </div>

        <!-- Controles de Navegaci√≥n -->
        <div class="reader-controls">
            <button class="nav-arrow prev" onclick="app.prevChapter()"><i class="fa-solid fa-chevron-left"></i></button>
            <button class="nav-arrow next" onclick="app.nextChapter()"><i class="fa-solid fa-chevron-right"></i></button>
        </div>

        <!-- Barra de Herramientas Inferior -->
        <div class="reader-toolbar">
            <button class="tool-btn" onclick="app.toggleReaderIndex()"><i class="fa-solid fa-list-ul"></i> √çndice</button>
            <button class="tool-btn" onclick="app.showReaderLore()"><i class="fa-solid fa-book-journal-whills"></i> Lore & Datos</button>
            <span id="readerProgress" class="reader-status">Cap√≠tulo 1/10</span>
        </div>
    </div>

    <!-- Overlay T√©cnico (Modern Data Archive) -->
    <div id="readerLoreOverlay" class="reader-lore-overlay" style="display: none;">
        <div class="lore-modern-container">
            <div class="lore-header">
                <div class="lore-title">
                    <i class="fa-solid fa-database"></i> 
                    <span>ARCHIVOS DE HISTORIA</span>
                </div>
                <button class="close-lore-btn" onclick="app.closeReaderLore()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div class="lore-body">
                <!-- Columna Principal: Sinopsis y Reglas -->
                <div class="lore-column-main">
                    <div class="lore-card">
                        <h3><i class="fa-solid fa-align-left"></i> Sinopsis</h3>
                        <p id="termSynopsis" class="lore-text">No data.</p>
                    </div>
                    <div class="lore-card">
                        <h3><i class="fa-solid fa-globe"></i> Reglas del Mundo</h3>
                        <p id="termRules" class="lore-text">No data.</p>
                    </div>
                </div>

                <!-- Columna Lateral: Escala de Poder -->
                <div class="lore-column-side">
                    <div class="lore-card">
                        <h3><i class="fa-solid fa-bolt"></i> Escala de Poder</h3>
                        <div id="termPowerScale" class="power-scale-visuals"></div>
                    </div>
                </div>

                <!-- Secci√≥n Inferior: √Ålbum -->
                <div class="gallery-section">
                    <div class="lore-card" style="background: transparent; border: none; padding: 0;">
                        <h3 style="margin-bottom: 1.5rem;"><i class="fa-solid fa-images"></i> Galer√≠a de Entidades</h3>
                        <div id="termAlbumGrid" class="gallery-grid">
                        <!-- Se llena con JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Sistema de Narrativa v2.0 - Vlog Style</p>
        </div>
    </footer>

    <script src="logros.js"></script>
    <script src="historias.js"></script>
</body>
</html>